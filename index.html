<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자기소개 프로그램</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .profile img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            margin-right: 20px;
            cursor: pointer; /* 클릭할 수 있도록 커서 변경 */
        }
        .hidden {
            display: none;
        }
        .category-table {
            width: 100%;
            border-collapse: collapse;
        }
        .category-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .add-category {
            margin-top: 10px;
            cursor: pointer;
        }
        .delete {
            color: red;
            cursor: pointer;
        }
        textarea {
            width: 100%;
            resize: vertical; /* 세로로만 크기 조절 가능 */
            overflow: auto; /* 내용이 넘칠 경우 스크롤 */
        }
        input[type="text"] {
            width: 100%;
            height: 40px; /* 고정된 높이 */
        }
        .button-container {
            display: flex;
            align-items: center;
        }
        .save-button {
            margin-left: 10px;
            cursor: pointer;
        }
        .file-button {
            display: none;
        }
    </style>
</head>
<body>

    <div class="profile">
        <img id="profilePic" src="https://via.placeholder.com/100" alt="프로필 사진" onclick="toggleFileInput()">
        <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="updateProfilePic()">
        <button id="pasteButton" class="file-button" onclick="pasteImage()">붙여넣기</button>
        <div>
            <input type="text" id="name" placeholder="이름">
            <br>
            <textarea id="bio" placeholder="간단한 소개" rows="2"></textarea>
        </div>
    </div>

    <table class="category-table">
        <tbody id="categoryList"></tbody>
    </table>

    <div class="button-container">
        <button class="add-category" onclick="addCategory()">+</button>
        <button class="save-button" onclick="saveAndShare()">저장 및 공유하기</button>
    </div>

    <script>
        function toggleFileInput() {
            const fileInput = document.getElementById('fileInput');
            const pasteButton = document.getElementById('pasteButton');
            fileInput.click();
            pasteButton.style.display = 'inline'; // 붙여넣기 버튼 보이기
        }

        function updateProfilePic() {
            const fileInput = document.getElementById('fileInput');
            const profilePic = document.getElementById('profilePic');

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onloadend = function() {
                profilePic.src = reader.result;
            }

            if (file) {
                reader.readAsDataURL(file);
            }
        }

        function pasteImage() {
            navigator.clipboard.read().then(function(items) {
                for (const item of items) {
                    if (item.types.includes('image/png')) {
                        const blob = item.getType('image/png');
                        const reader = new FileReader();
                        reader.onloadend = function() {
                            document.getElementById('profilePic').src = reader.result;
                        }
                        blob.then(function(b) {
                            reader.readAsDataURL(b);
                        });
                    }
                }
            });
        }

        function addCategory() {
            const categoryList = document.getElementById('categoryList');
            const row = document.createElement('tr');

            row.innerHTML = `
                <td><textarea placeholder="카테고리" rows="2"></textarea></td>
                <td><textarea placeholder="설명" rows="2" oninput="this.rows = Math.min(this.value.split('\n').length, 5);"></textarea></td>
                <td><span class="delete" onclick="deleteCategory(this)">x</span></td>
            `;
            categoryList.appendChild(row);
        }

        function deleteCategory(element) {
            const row = element.parentElement.parentElement;
            row.parentElement.removeChild(row);
        }

        function saveAndShare() {
            const name = document.getElementById('name').value;
            const bio = document.getElementById('bio').value;
            const categories = Array.from(document.querySelectorAll('#categoryList textarea')).map(textarea => textarea.value).join('|');

            const shareData = {
                name: name,
                bio: bio,
                categories: categories
            };

            const encodedData = encodeURIComponent(JSON.stringify(shareData));
            const link = `${window.location.origin}/view?data=${encodedData}`;

            alert(`링크가 생성되었습니다: ${link}`);
        }
    </script>

</body>
</html>
