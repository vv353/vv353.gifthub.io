<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자기소개 프로그램</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* 전체 내용을 가운데 정렬 */
        }
        .profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .profile img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            margin-right: 20px;
        }
        .category-table {
            width: 100%;
            border-collapse: collapse;
        }
        .category-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .arrow {
            cursor: pointer;
        }
        .delete {
            cursor: pointer;
            color: red;
        }
        .input-container {
            margin-bottom: 10px;
        }
        .button-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="profile">
    <input type="file" id="profile-image-input" accept="image/*" onchange="updateProfileImage()">
    <img id="profile-image" src="profile.jpg" alt="프로필 사진">
    <div>
        <input type="text" id="name-input" placeholder="이름" oninput="updateName()">
        <textarea id="introduction-input" placeholder="간단한 소개" oninput="updateIntroduction()"></textarea>
    </div>
</div>

<h3>카테고리 추가</h3>
<div class="input-container">
    <input type="text" id="category-input" placeholder="카테고리">
    <input type="text" id="description-input" placeholder="설명">
    <button onclick="addCategory()">추가</button>
</div>

<table class="category-table">
    <tbody id="category-list"></tbody>
</table>

<div class="button-container">
    <button onclick="generateLink()">링크 생성 및 공유</button>
    <p id="share-link"></p>
</div>

<script>
    const categories = [];

    function updateProfileImage() {
        const fileInput = document.getElementById('profile-image-input');
        const file = fileInput.files[0];
        const profileImage = document.getElementById('profile-image');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                profileImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function updateName() {
        // 이름 업데이트 로직
    }

    function updateIntroduction() {
        // 소개 업데이트 로직
    }

    function addCategory() {
        const categoryInput = document.getElementById('category-input');
        const descriptionInput = document.getElementById('description-input');
        const categoryList = document.getElementById('category-list');

        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="arrow" onclick="moveUp(this)">↑</td>
            <td class="arrow" onclick="moveDown(this)">↓</td>
            <td><input type="text" value="${categoryInput.value}" oninput="updateCategory(this)"></td>
            <td><input type="text" value="${descriptionInput.value}" oninput="updateDescription(this)"></td>
            <td class="delete" onclick="removeCategory(this)">✖</td>
        `;
        categoryList.appendChild(row);

        categories.push({ category: categoryInput.value, description: descriptionInput.value });
        categoryInput.value = '';
        descriptionInput.value = '';
    }

    function moveUp(element) {
        const row = element.parentElement;
        const previousRow = row.previousElementSibling;
        if (previousRow) {
            row.parentElement.insertBefore(row, previousRow);
        }
    }

    function moveDown(element) {
        const row = element.parentElement;
        const nextRow = row.nextElementSibling;
        if (nextRow) {
            row.parentElement.insertBefore(nextRow, row);
        }
    }

    function removeCategory(element) {
        const row = element.parentElement;
        const index = Array.from(row.parentNode.children).indexOf(row);
        categories.splice(index, 1);
        row.remove();
    }

    function updateCategory(input) {
        const index = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode.parentNode);
        categories[index].category = input.value;
    }

    function updateDescription(input) {
        const index = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode.parentNode);
        categories[index].description = input.value;
    }

    function generateLink() {
        const name = document.getElementById('name-input').value;
        const introduction = document.getElementById('introduction-input').value;
        const profileImage = document.getElementById('profile-image').src;

        const data = {
            name,
            introduction,
            profileImage,
            categories
        };

        const jsonData = encodeURIComponent(JSON.stringify(data));
        const link = `${window.location.origin}/?data=${jsonData}`;

        document.getElementById('share-link').innerHTML = `<a href="${link}" target="_blank">링크 복사</a>`;
    }

    function loadSharedData() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');

        if (data) {
            const parsedData = JSON.parse(decodeURIComponent(data));
            document.getElementById('name-input').value = parsedData.name;
            document.getElementById('introduction-input').value = parsedData.introduction;
            document.getElementById('profile-image').src = parsedData.profileImage;

            parsedData.categories.forEach(category => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="arrow" onclick="moveUp(this)">↑</td>
                    <td class="arrow" onclick="moveDown(this)">↓</td>
                    <td><input type="text" value="${category.category}" oninput="updateCategory(this)"></td>
                    <td><input type="text" value="${category.description}" oninput="updateDescription(this)"></td>
                    <td class="delete" onclick="removeCategory(this)">✖</td>
                `;
                document.getElementById('category-list').appendChild(row);
            });
        }
    }

    window.onload = loadSharedData;

</script>

</body>
</html>
