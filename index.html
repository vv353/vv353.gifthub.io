<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자기소개 프로그램</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .profile img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            margin-right: 20px;
            cursor: pointer;
        }
        .file-buttons {
            display: none;
            position: absolute;
            margin-top: -70px; /* 이미지 위로 위치 조정 */
            margin-left: 120px; /* 이미지 우측 위치 조정 */
        }
        .file-buttons button {
            margin-right: 5px;
        }
        .category-table {
            width: 100%;
            border-collapse: collapse;
        }
        .category-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
            vertical-align: top; /* 입력란이 늘어날 때 위쪽 정렬 */
        }
        .arrow {
            cursor: pointer;
        }
        .delete {
            cursor: pointer;
            color: red;
        }
        .input-container {
            margin-bottom: 10px;
        }
        .paste-area {
            border: 1px dashed #ccc;
            padding: 10px;
            min-height: 50px;
            margin-bottom: 10px;
        }
        input[type="text"], textarea {
            width: 100%;
            box-sizing: border-box; /* 패딩을 포함한 너비 계산을 위해 */
            resize: vertical; /* 세로 방향으로 크기 조절 가능 */
        }
        textarea {
            min-height: 50px; /* 최소 높이 설정 */
        }
    </style>
</head>
<body>

<div class="profile">
    <div class="paste-area" contenteditable="true" onpaste="handlePaste(event)">
        여기에 이미지를 붙여넣으세요 (Ctrl + V)
    </div>
    <div style="position: relative;">
        <img id="profile-image" src="profile.jpg" alt="프로필 사진" onmouseover="showFileButtons()" onmouseout="hideFileButtons()" onclick="fileInput.click()">
        <div class="file-buttons" id="file-buttons">
            <input type="file" id="profile-image-input" accept="image/*" onchange="updateProfileImage()">
            <button onclick="fileInput.click()">파일 선택</button>
            <button onclick="document.execCommand('paste')">붙여넣기</button>
        </div>
    </div>
    <div>
        <input type="text" id="name-input" placeholder="이름" oninput="updateName()">
        <textarea id="introduction-input" placeholder="간단한 소개" oninput="updateIntroduction()"></textarea>
    </div>
</div>

<h3>카테고리 추가</h3>
<button onclick="addCategory()">추가</button>

<table class="category-table">
    <tbody id="category-list"></tbody>
</table>

<button onclick="generateLink()">링크 생성 및 공유</button>
<p id="share-link"></p>

<script>
    const categories = [];

    function updateProfileImage(src) {
        const profileImage = document.getElementById('profile-image');
        profileImage.src = src;
    }

    function handlePaste(event) {
        event.preventDefault();
        const items = event.clipboardData.items;

        for (let i = 0; i < items.length; i++) {
            const item = items[i];

            if (item.type.startsWith('image/')) {
                const file = item.getAsFile();
                const reader = new FileReader();

                reader.onload = function(event) {
                    updateProfileImage(event.target.result);
                };

                reader.readAsDataURL(file);
            }
        }
    }

    function showFileButtons() {
        document.getElementById('file-buttons').style.display = 'block';
    }

    function hideFileButtons() {
        document.getElementById('file-buttons').style.display = 'none';
    }

    function updateName() {
        const nameInput = document.getElementById('name-input');
        const name = nameInput.value;
        document.getElementById('name-display').innerText = name;
    }

    function updateIntroduction() {
        const introductionInput = document.getElementById('introduction-input');
        const introduction = introductionInput.value;
        document.getElementById('introduction-display').innerText = introduction;
    }

    function addCategory() {
        const categoryList = document.getElementById('category-list');

        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="arrow" onclick="moveUp(this)">↑</td>
            <td class="arrow" onclick="moveDown(this)">↓</td>
            <td><input type="text" placeholder="카테고리" oninput="updateCategory(this)"></td>
            <td><textarea placeholder="설명" oninput="updateDescription(this)"></textarea></td>
            <td class="delete" onclick="removeCategory(this)">✖</td>
        `;
        categoryList.appendChild(row);
    }

    function moveUp(element) {
        const row = element.parentElement;
        const previousRow = row.previousElementSibling;
        if (previousRow) {
            row.parentElement.insertBefore(row, previousRow);
        }
    }

    function moveDown(element) {
        const row = element.parentElement;
        const nextRow = row.nextElementSibling;
        if (nextRow) {
            row.parentElement.insertBefore(nextRow, row);
        }
    }

    function removeCategory(element) {
        const row = element.parentElement;
        const index = Array.from(row.parentNode.children).indexOf(row);
        categories.splice(index, 1);
        row.remove();
    }

    function updateCategory(input) {
        const index = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode.parentNode);
        categories[index].category = input.value;
    }

    function updateDescription(input) {
        const index = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode.parentNode);
        categories[index].description = input.value;
    }

    function generateLink() {
        const name = document.getElementById('name-input').value;
        const introduction = document.getElementById('introduction-input').value;
        const profileImage = document.getElementById('profile-image').src;

        const data = {
            name,
            introduction,
            profileImage,
            categories
        };

        const jsonData = encodeURIComponent(JSON.stringify(data));
        const link = `${window.location.origin}/?data=${jsonData}`;

        document.getElementById('share-link').innerHTML = `<a href="${link}" target="_blank">링크 복사</a>`;
    }

    function loadSharedData() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');

        if (data) {
            const parsedData = JSON.parse(decodeURIComponent(data));
            document.getElementById('name-input').value = parsedData.name;
            document.getElementById('introduction-input').value = parsedData.introduction;
            document.getElementById('profile-image').src = parsedData.profileImage;

            parsedData.categories.forEach(category => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="arrow" onclick="moveUp(this)">↑</td>
                    <td class="arrow" onclick="moveDown(this)">↓</td>
                    <td><input type="text" value="${category.category}" oninput="updateCategory(this)"></td>
                    <td><textarea oninput="updateDescription(this)">${category.description}</textarea></td>
                    <td class="delete" onclick="removeCategory(this)">✖</td>
                `;
                document.getElementById('category-list').appendChild(row);
            });
        }
    }

    window.onload = loadSharedData;

</script>

</body>
</html>
