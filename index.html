<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자기소개 프로그램</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* 전체 내용을 가운데 정렬 */
        }
        .profile {
            display: flex;
            flex-direction: column; /* 세로 방향으로 배치 */
            align-items: center;
            margin-bottom: 20px;
        }
        .plus-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            text-align: center;
            cursor: pointer;
            position: relative; /* 위치 조정 */
        }
        .file-options {
            display: none; /* 기본적으로 숨김 */
            margin-top: 10px; /* 버튼과의 간격 */
        }
        .category-table {
            width: 100%;
            border-collapse: collapse;
        }
        .category-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .category-table .delete {
            text-align: center; /* X 버튼 중앙 정렬 */
            color: red; /* X 버튼 빨간색 */
            cursor: pointer; /* 클릭할 수 있도록 커서 변경 */
        }
        .button-container {
            display: flex;
            justify-content: space-between; /* 좌우 정렬 */
            width: 100%; /* 전체 너비 사용 */
            margin-top: 10px;
        }
        .add-category {
            cursor: pointer;
            margin-right: 10px; /* 여백 조정 */
        }
        .save-button {
            margin-left: auto; /* 오른쪽 정렬 */
            cursor: pointer;
        }
        textarea {
            width: 100%;
            resize: vertical; /* 세로로만 크기 조절 가능 */
            overflow: auto; /* 내용이 넘칠 경우 스크롤 */
        }
        input[type="text"] {
            width: 100%;
            height: 40px; /* 고정된 높이 */
        }
    </style>
</head>
<body>

    <div class="profile">
        <div class="plus-icon" onclick="showFileOptions()">+</div>
        <div class="file-options" id="fileOptions">
            <input type="file" id="fileInput" accept="image/*" onchange="updateProfilePic()">
            <button id="pasteButton" onclick="pasteImage()">붙여넣기</button>
        </div>
        <div>
            <input type="text" id="name" placeholder="이름">
            <br>
            <textarea id="bio" placeholder="간단한 소개" rows="2"></textarea>
        </div>
    </div>

    <table class="category-table">
        <tbody id="categoryList"></tbody>
    </table>

    <div class="button-container">
        <button class="add-category" onclick="addCategory()">+</button>
        <button class="save-button" onclick="saveAndShare()">저장 및 공유하기</button>
    </div>

    <script>
        function showFileOptions() {
            const fileOptions = document.getElementById('fileOptions');
            fileOptions.classList.toggle('hidden'); // 파일 선택 및 붙여넣기 버튼 표시/숨기기
            fileOptions.style.display = fileOptions.style.display === 'none' ? 'block' : 'none'; // 토글 기능
        }

        function updateProfilePic() {
            const fileInput = document.getElementById('fileInput');
            const plusIcon = document.querySelector('.plus-icon');

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onloadend = function() {
                plusIcon.style.backgroundImage = `url(${reader.result})`;
                plusIcon.style.backgroundSize = 'cover'; // 이미지가 버튼을 가득 채우도록 설정
                plusIcon.textContent = ''; // "+" 문구 제거
            }

            if (file) {
                reader.readAsDataURL(file);
            }
        }

        function pasteImage() {
            navigator.clipboard.read().then(function(items) {
                for (const item of items) {
                    if (item.types.includes('image/png')) {
                        const blob = item.getType('image/png');
                        const reader = new FileReader();
                        reader.onloadend = function() {
                            const plusIcon = document.querySelector('.plus-icon');
                            plusIcon.style.backgroundImage = `url(${reader.result})`;
                            plusIcon.style.backgroundSize = 'cover'; // 이미지가 버튼을 가득 채우도록 설정
                            plusIcon.textContent = ''; // "+" 문구 제거
                        }
                        blob.then(function(b) {
                            reader.readAsDataURL(b);
                        });
                    }
                }
            });
        }

        function addCategory() {
            const categoryList = document.getElementById('categoryList');
            const row = document.createElement('tr');

            row.innerHTML = `
                <td><textarea placeholder="카테고리" rows="2"></textarea></td>
                <td><textarea placeholder="설명" rows="2" oninput="this.rows = Math.min(this.value.split('\n').length, 5);"></textarea></td>
                <td class="delete" onclick="deleteCategory(this)">x</td>
            `;
            categoryList.appendChild(row);
        }

        function deleteCategory(element) {
            const row = element.parentElement;
            row.parentElement.removeChild(row);
        }

        function saveAndShare() {
            const name = document.getElementById('name').value;
            const bio = document.getElementById('bio').value;
            const categories = Array.from(document.querySelectorAll('#categoryList textarea')).map(textarea => textarea.value).join('|');

            const shareData = {
                name: name,
                bio: bio,
                categories: categories
            };

            const encodedData = encodeURIComponent(JSON.stringify(shareData));
            const link = `${window.location.origin}/view?data=${encodedData}`;

            alert(`링크가 생성되었습니다: ${link}`);
        }
    </script>

</body>
</html>
